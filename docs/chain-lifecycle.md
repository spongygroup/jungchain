# ì •ì²´ì¸ ë¼ì´í”„ì‚¬ì´í´

> ì •ì²´ì¸ì˜ ì‹œì‘ë¶€í„° ì™„ì£¼/ì „ë‹¬ê¹Œì§€ ëª¨ë“  ì¼€ì´ìŠ¤ë¥¼ ì •ë¦¬í•œ ë¬¸ì„œ

---

## ëª©ì°¨

1. [ì²´ì¸ ìƒì„±](#1-ì²´ì¸-ìƒì„±)
2. [ë¦´ë ˆì´ ë°°ì • (í¬ë¡ )](#2-ë¦´ë ˆì´-ë°°ì •)
3. [ë¸”ë¡ ì‘ì„±](#3-ë¸”ë¡-ì‘ì„±)
4. [ì •ë‚˜ë¬´ (í¬í¬)](#4-ì •ë‚˜ë¬´-í¬í¬)
5. [ì²´ì¸ ë§Œë£Œ & ì™„ì£¼](#5-ì²´ì¸-ë§Œë£Œ--ì™„ì£¼)
6. [ì™„ì£¼ ì•Œë¦¼](#6-ì™„ì£¼-ì•Œë¦¼)
7. [NFT ì„ íƒ & ë¯¼íŒ…](#7-nft-ì„ íƒ--ë¯¼íŒ…)
8. [ì™„ì£¼ ì•¨ë²” ì „ì†¡](#8-ì™„ì£¼-ì•¨ë²”-ì „ì†¡)
9. [ì—£ì§€ ì¼€ì´ìŠ¤](#9-ì—£ì§€-ì¼€ì´ìŠ¤)
10. [ìƒíƒœ ë‹¤ì´ì–´ê·¸ë¨](#10-ìƒíƒœ-ë‹¤ì´ì–´ê·¸ë¨)
11. [íƒ€ì´ë° ìƒìˆ˜](#11-íƒ€ì´ë°-ìƒìˆ˜)

---

## 1. ì²´ì¸ ìƒì„±

### íŠ¸ë¦¬ê±°
- ìœ ì €ê°€ "ìƒˆ ì • ì‹œì‘" ë²„íŠ¼ í´ë¦­ (`menu:new`) ë˜ëŠ” `/new` ëª…ë ¹ì–´

### í”Œë¡œìš°

```
ìœ ì € â†’ [ìƒˆ ì • ì‹œì‘] â†’ ê²€ì¦ â†’ ì‚¬ì§„ ì „ì†¡ â†’ AI ê²€ì¦ â†’ ì²´ì¸+ë¸”ë¡ ìƒì„± â†’ í™•ì¸ ë©”ì‹œì§€
```

#### 1.1 ê²€ì¦
- ìœ ì € ë“±ë¡ ì—¬ë¶€ (ë¯¸ë“±ë¡ â†’ ìœ„ì¹˜ ê³µìœ  ì•ˆë‚´)
- ì¼ì¼ ì‹œì‘ ì œí•œ: **í•˜ë£¨ ìµœëŒ€ 3ê°œ** (`maxDailyStarts`, UTC ìì • ë¦¬ì…‹)
- ê°™ì€ ë¡œì»¬ ì‹œê°„ëŒ€ ì¤‘ë³µ ë°©ì§€: ê°™ì€ ë‚  ê°™ì€ ë¡œì»¬ ì‹œ(hour)ì— 2ê°œ ë¶ˆê°€

#### 1.2 ì‚¬ì§„ + ìº¡ì…˜ ìˆ˜ì§‘
1. ìœ ì €ë¥¼ `pendingNewChain` Setì— ì¶”ê°€
2. "ì‚¬ì§„ì„ ë³´ë‚´ì£¼ì„¸ìš”" í”„ë¡¬í”„íŠ¸
3. ì‚¬ì§„ ìˆ˜ì‹  â†’ `pendingPhoto` Mapì— ì €ì¥
4. ìº¡ì…˜ ì…ë ¥ ëŒ€ê¸° (ì„ íƒì‚¬í•­, `/skip` ê°€ëŠ¥)

#### 1.3 AI ê²€ì¦
- **ì‚¬ì§„**: Gemini 2.0 Flash â†’ ì‹¤íŒ¨ ì‹œ OpenAI 4o-mini í´ë°±
- **í…ìŠ¤íŠ¸**: ë™ì¼ ì´ì¤‘ í´ë°±
- ì•ˆì „ ìœ„ë°˜ â†’ ê±°ë¶€ ë©”ì‹œì§€ + ì¬ì‹œë„ ì•ˆë‚´

#### 1.4 ì²´ì¸ & ë¸”ë¡ ìƒì„±
1. `createChain(userId, tzOffset, startUtc, 'free', localHour)`
   - status: `active`
   - `root_chain_id` = ìê¸° ìì‹  (ë£¨íŠ¸ ì²´ì¸)
   - `chain_hour` = ìœ ì €ì˜ ë¡œì»¬ ì‹œ(hour)
2. `createAssignment(userId, chainId, slot=1, expiresAt)`
3. `addBlock(chainId, slot=1, userId, tzOffset, caption, photoId, 'photo')`
4. ì–´ì‚¬ì¸ë¨¼íŠ¸ â†’ `written`ìœ¼ë¡œ ì—…ë°ì´íŠ¸
5. ì˜¨ì²´ì¸ ê¸°ë¡ (í™œì„±í™” ì‹œ): `createOnchainChain()` + `recordBlock()`

#### 1.5 í™•ì¸ ë©”ì‹œì§€
```
ì •ì´ ì¶œë°œí•©ë‹ˆë‹¤! ğŸŒ
1/24 ìŠ¬ë¡¯ Â· ë‹¤ìŒ ëª©ì ì§€: UTC+8
```

### DB ìƒíƒœ
| í…Œì´ë¸” | ìƒíƒœ |
|--------|------|
| chains | status=`active`, block_count=1 |
| blocks | slot_index=1, ìœ ì €ì˜ ì‚¬ì§„+ìº¡ì…˜ |
| assignments | status=`written` |

---

## 2. ë¦´ë ˆì´ ë°°ì •

### íŠ¸ë¦¬ê±°
- **í¬ë¡ **: ë§¤ì‹œ ì •ê° (`isTopOfHour`) â€” `getUsersByNotifyHour(utcHour)`

### í”Œë¡œìš°

```
í¬ë¡  ì •ê° â†’ í•´ë‹¹ ì‹œê°„ëŒ€ ìœ ì € ì¡°íšŒ â†’ ë°°ì • ê°€ëŠ¥ ì²´ì¸ íƒìƒ‰ â†’ ì–´ì‚¬ì¸ë¨¼íŠ¸ ìƒì„± â†’ ë„ì°© ë©”ì‹œì§€ ì „ì†¡
```

#### 2.1 ëŒ€ìƒ ìœ ì € ì„ íƒ
- ê° ìœ ì €ì˜ `notify_hours` JSON ë°°ì—´ì—ì„œ í˜„ì¬ ë¡œì»¬ ì‹œ(hour) í¬í•¨ ì—¬ë¶€ í™•ì¸
- ê¸°ë³¸ê°’: ì˜¤ì „ 8ì‹œ ~ ì˜¤í›„ 10ì‹œ (14ì‹œê°„)
- ë¹„í™œì„±: `notify_hours = '[]'` (ë¹ˆ ë°°ì—´)

#### 2.2 ë°°ì • ê°€ëŠ¥ ì²´ì¸ íƒìƒ‰ (`findAllChainsForUser`)
ì¡°ê±´:
- status = `active`
- ìœ ì €ê°€ ì°¸ì—¬í•œ ì  ì—†ìŒ (blocksì—ë„ assignmentsì—ë„ ì—†ìŒ)
- ì•„ì§ ë§Œë£Œ ì•ˆ ë¨ (rootì˜ start_utc + 24h > now)

#### 2.3 ì–´ì‚¬ì¸ë¨¼íŠ¸ ìƒì„±
- ê° ì²´ì¸ì˜ ë§ˆì§€ë§‰ ë¸”ë¡ â†’ ë‹¤ìŒ ìŠ¬ë¡¯ ê³„ì‚°
- slot > 24ì´ë©´ ìŠ¤í‚µ (ì²´ì¸ ê½‰ ì°¸)
- ë§Œë£Œ: ìƒì„± í›„ 1ì‹œê°„

#### 2.4 ë„ì°© ë©”ì‹œì§€
**ì²« ë²ˆì§¸ ì–´ì‚¬ì¸ë¨¼íŠ¸ë§Œ ì¦‰ì‹œ í‘œì‹œ**, ë‚˜ë¨¸ì§€ëŠ” íì— ëŒ€ê¸°

```
ğŸ•˜ ì˜¤ì „ 9ì‹œ, 2ê°œì˜ ì •ì´ ë„ì°©í–ˆìŠµë‹ˆë‹¤
ë§ˆê°: ì˜¤ì „ 10ì‹œ

ğŸŒ ì„±ë‚¨ì‹œì—ì„œ JBë‹˜ì´ ë³´ë‚¸ ì •ì´ ë„ì°©í–ˆìŠµë‹ˆë‹¤! (5/24)
[ì‚¬ì§„ + ìº¡ì…˜ + ë²ˆì—­]
ğŸ“· 2026.02.21 09:15 (UTC+9)

[âœï¸ ì´ì–´ì“°ê¸°] [â­ï¸ ìŠ¤í‚µ (1)]

âš ï¸ ìŠ¤í‚µì„ ëˆ„ë¥´ë©´ í•´ë‹¹ ì •ì€ ì‚¬ë¼ì§€ë©° ì´ì–´ê°ˆ ìˆ˜ ì—†ì–´ìš”!
```

---

## 3. ë¸”ë¡ ì‘ì„±

### íŠ¸ë¦¬ê±°
- ìœ ì €ê°€ ë„ì°© ë©”ì‹œì§€ì˜ "ì´ì–´ì“°ê¸°" ë²„íŠ¼ í´ë¦­

### í”Œë¡œìš°

```
[ì´ì–´ì“°ê¸°] â†’ assignment=writing â†’ ì‚¬ì§„ ì „ì†¡ â†’ ìº¡ì…˜ â†’ AI ê²€ì¦ â†’ ë¸”ë¡ ì €ì¥ â†’ (í¬í¬ ì²´í¬)
```

#### 3.1 ì´ì–´ì“°ê¸° ë²„íŠ¼ (`write:{assignmentId}`)
1. ì†Œìœ ê¶Œ ê²€ì¦: `assignment.user_id === userId`
2. ì–´ì‚¬ì¸ë¨¼íŠ¸ ìƒíƒœ: `pending` â†’ `writing`
3. "ì‚¬ì§„ì„ ë³´ë‚´ì£¼ì„¸ìš”" í”„ë¡¬í”„íŠ¸

#### 3.2 ì‚¬ì§„ + ìº¡ì…˜ + AI ê²€ì¦
ì²´ì¸ ìƒì„±ê³¼ ë™ì¼í•œ í”Œë¡œìš°

#### 3.3 ë¸”ë¡ ì €ì¥
1. **í¬í¬ ì²´í¬**: `blockExistsAtSlot(chainId, slotIndex)`
   - ì´ë¯¸ ë‹¤ë¥¸ ìœ ì €ê°€ ê°™ì€ ìŠ¬ë¡¯ì— ì¼ìœ¼ë©´ â†’ [ì •ë‚˜ë¬´ í¬í¬](#4-ì •ë‚˜ë¬´-í¬í¬)
2. `addBlock(targetChainId, slotIndex, userId, tzOffset, caption, photoId, 'photo')`
3. ì–´ì‚¬ì¸ë¨¼íŠ¸: `writing` â†’ `written`
4. ì˜¨ì²´ì¸ ê¸°ë¡ (í™œì„±í™” ì‹œ)

#### 3.4 ì™„ì£¼ ì²´í¬
- slot >= 24 â†’ `completeChain(chainId)` â†’ status=`completed`
- slot < 24 â†’ ì •ì§€ê¸° ì½”ë©˜íŠ¸ + ì§„í–‰ ìƒí™© ë©”ì‹œì§€

#### 3.5 ë‹¤ìŒ ì–´ì‚¬ì¸ë¨¼íŠ¸
- íì— ëŒ€ê¸° ì¤‘ì¸ ì–´ì‚¬ì¸ë¨¼íŠ¸ê°€ ìˆìœ¼ë©´ ì¦‰ì‹œ ë‹¤ìŒ í‘œì‹œ
- ì—†ìœ¼ë©´ "ëª¨ë“  ì •ì„ í™•ì¸í–ˆì–´ìš”!" ë©”ì‹œì§€

---

## 4. ì •ë‚˜ë¬´ (í¬í¬)

### íŠ¸ë¦¬ê±°
- ê°™ì€ ìŠ¬ë¡¯ì— ì—¬ëŸ¬ ìœ ì €ê°€ ë™ì‹œì— ë°°ì •ë°›ì•„ ì‘ì„±í•  ë•Œ

### ì™œ ë°œìƒí•˜ëŠ”ê°€?
í¬ë¡ ì´ ê°™ì€ íƒ€ì„ì¡´ì˜ ì—¬ëŸ¬ ìœ ì €ì—ê²Œ ê°™ì€ ì²´ì¸ì„ ë°°ì • â†’ ëª¨ë‘ ê°™ì€ ìŠ¬ë¡¯ì— ì‘ì„± ì‹œë„

### í”Œë¡œìš°

```
ìœ ì € A: ìŠ¬ë¡¯ 5 ì‘ì„± â†’ ì›ë³¸ ì²´ì¸ #100ì— ì €ì¥
ìœ ì € B: ìŠ¬ë¡¯ 5 ì‘ì„± â†’ blockExistsAtSlot=true â†’ í¬í¬ ì²´ì¸ #101 ìƒì„±
ìœ ì € C: ìŠ¬ë¡¯ 5 ì‘ì„± â†’ blockExistsAtSlot=true â†’ í¬í¬ ì²´ì¸ #102 ìƒì„±
```

#### 4.1 í¬í¬ ìƒì„± (`createForkChain`)
1. ìƒˆ ì²´ì¸ row ìƒì„±
   - `parent_chain_id` = ì›ë³¸ ì²´ì¸
   - `fork_slot` = ê°ˆë¼ì§„ ìŠ¬ë¡¯ ë²ˆí˜¸
   - `root_chain_id` = ì›ë³¸ì˜ ë£¨íŠ¸ (íŠ¸ë¦¬ ì „ì²´ì—ì„œ ê³µìœ )
   - start_utc, mode, chain_hour, mission ìƒì†
2. **Copy-on-Fork**: í¬í¬ ì§€ì  ì´ì „ì˜ ë¸”ë¡ë“¤ ë³µì‚¬
   - ìŠ¬ë¡¯ 1~4ë¥¼ ì›ë³¸ì—ì„œ í¬í¬ ì²´ì¸ìœ¼ë¡œ ë³µì‚¬
3. ìƒˆ ë¸”ë¡ì„ í¬í¬ ì²´ì¸ì— ì¶”ê°€

#### 4.2 í¬í¬ íŠ¸ë¦¬ êµ¬ì¡°
```
ë£¨íŠ¸ #100 (start: 2026-02-21 09:00)
â”œâ”€â”€ í¬í¬ #101 (fork_slot=5, parent=#100)
â”‚   â””â”€â”€ í¬í¬ #103 (fork_slot=12, parent=#101, root=#100)
â””â”€â”€ í¬í¬ #102 (fork_slot=8, parent=#100)
```

#### 4.3 ë§Œë£Œ
- ëª¨ë“  í¬í¬ëŠ” **ë£¨íŠ¸ ì²´ì¸ì˜ start_utc + 24h**ì— í•¨ê»˜ ë§Œë£Œ
- ë¬´í•œ í¬í¬ ë°©ì§€

---

## 5. ì²´ì¸ ë§Œë£Œ & ì™„ì£¼

### 5.1 ì‹œê°„ ê¸°ë°˜ ë§Œë£Œ (ì¼ë°˜ì  ê²½ë¡œ)

#### íŠ¸ë¦¬ê±°
- **í¬ë¡ **: ë§¤ë¶„ ì‹¤í–‰ (`* * * * *`)

#### í”Œë¡œìš°
```
ë§¤ë¶„ í¬ë¡  â†’ getExpiredActiveChains(now) â†’ completeChain(id) â†’ status=completed
```

#### ì¡°ê±´
```sql
SELECT c.* FROM chains c
JOIN chains r ON r.id = c.root_chain_id
WHERE c.status = 'active'
  AND datetime(r.start_utc, '+24 hours') <= datetime(now)
```
- ë£¨íŠ¸ ì²´ì¸ì˜ ì‹œì‘ ì‹œê°„ ê¸°ì¤€ 24ì‹œê°„ ê²½ê³¼

#### DB ë³€ê²½
- status: `active` â†’ `completed`
- `completed_at` = now
- `deliver_at` = start_utc + 24h

### 5.2 ìŠ¬ë¡¯ 24 ë„ë‹¬ (ì™„ì£¼)

#### íŠ¸ë¦¬ê±°
- ìœ ì €ê°€ 24ë²ˆì§¸ ë¸”ë¡ ì‘ì„±

#### í”Œë¡œìš°
- ë¸”ë¡ ì €ì¥ ì‹œ slot >= 24 ê°ì§€
- `completeChain(chainId)` í˜¸ì¶œ
- ë™ì¼í•˜ê²Œ `completed` ìƒíƒœë¡œ ì „í™˜

### ì°¸ê³ 
- ë¯¸ì™„ì£¼ ì²´ì¸: 24h ê²½ê³¼ ì‹œ ë¸”ë¡ ìˆ˜ì— ê´€ê³„ì—†ì´ ë§Œë£Œ (ì˜ˆ: 8ë¸”ë¡ì—ì„œ ë§Œë£Œ)
- ì†”ë¡œ ì²´ì¸: ì•„ë¬´ë„ ì´ì–´ì“°ì§€ ì•Šìœ¼ë©´ 1ë¸”ë¡ìœ¼ë¡œ ë§Œë£Œ

---

## 6. ì™„ì£¼ ì•Œë¦¼

### íŠ¸ë¦¬ê±°
- **í¬ë¡ **: ë§¤ë¶„ ì‹¤í–‰, `getChainsToDeliver(now)` ì¡°íšŒ

### ì¡°ê±´
```sql
SELECT * FROM chains WHERE status = 'completed' AND deliver_at <= now
```
- ì²´ì¸ ì‹œì‘ ì‹œê°„ê³¼ ê°™ì€ ë¡œì»¬ ì‹œ(hour)ì— ì „ë‹¬
- ì˜ˆ: ê¸ˆìš”ì¼ ì˜¤ì „ 9ì‹œ ì‹œì‘ â†’ í† ìš”ì¼ ì˜¤ì „ 9ì‹œ ì „ë‹¬

### í”Œë¡œìš°

```
í¬ë¡  â†’ ì „ë‹¬ ëŒ€ìƒ ì¡°íšŒ â†’ notifyChainComplete(chainId) â†’ NFT ì„ íƒ or ì•¨ë²” ì „ì†¡
```

#### 6.1 ì™„ì£¼ ë©”ì‹œì§€ ìƒì„± (`notifyChainComplete`)

**ì°¸ì—¬ì ê³„ì‚°**:
1. ëª¨ë“  ë¸”ë¡ì—ì„œ ìœ ì €ë³„ ë„ì‹œ ì¡°íšŒ (ìœ ì € DBì˜ ì‹¤ì œ ë“±ë¡ ë„ì‹œ)
2. `othersCount` = ì‹œì‘ì ì œì™¸ ê³ ìœ  ì°¸ì—¬ì ìˆ˜
3. `uniqueCities` = ê³ ìœ  ë„ì‹œ ìˆ˜

**ë©”ì‹œì§€ ë¶„ê¸°**:

| ì¼€ì´ìŠ¤ | ë©”ì‹œì§€ |
|--------|--------|
| ë‹¤ë¥¸ ì°¸ì—¬ì ìˆìŒ | `ğŸ ë‹¹ì‹ ì˜ ì •ì´ ì§€êµ¬ë¥¼ ëŒì•„ì™”ìŠµë‹ˆë‹¤!\n{N}ëª…ì´ í•¨ê»˜í–ˆì–´ìš” Â· {M}ê°œ ë„ì‹œë¥¼ ê±°ì³¤ì–´ìš”` |
| ì†”ë¡œ (í˜¼ìë§Œ) | `ğŸ ë‹¹ì‹ ì˜ ì •ì´ ì§€êµ¬ë¥¼ ëŒì•„ì™”ìŠµë‹ˆë‹¤!\nì´ë²ˆ ì •ì€ ë‹¹ì‹ ë§Œì˜ ê¸°ë¡ì´ì—ìš”. ë‹¤ìŒì—” ëˆ„êµ°ê°€ ì´ì–´ì¤„ ê±°ì˜ˆìš”.` |

**ë„ì‹œ ë£¨íŠ¸**:
```
ğŸ‡°ğŸ‡· ì„±ë‚¨ì‹œ â†’ ğŸ‡¯ğŸ‡µ ë„ì¿„ â†’ ğŸ‡¨ğŸ‡³ ìƒí•˜ì´ â†’ ğŸ‡¹ğŸ‡­ ë°©ì½• â†’ ...
```

#### 6.2 ìƒíƒœ ì „í™˜

| ì˜¨ì²´ì¸ í™œì„± | ë™ì‘ | ìƒíƒœ ë³€í™” |
|-------------|------|-----------|
| O | NFT ìŠ¤íƒ€ì¼ ì„ íƒ ë©”ì‹œì§€ ì „ì†¡ | `completed` â†’ `notified` |
| X | ì•¨ë²” ë°”ë¡œ ì „ì†¡ | `completed` â†’ `delivered` |

---

## 7. NFT ì„ íƒ & ë¯¼íŒ…

### 7.1 NFT ìŠ¤íƒ€ì¼ ì„ íƒ

#### íŠ¸ë¦¬ê±°
- ì™„ì£¼ ì•Œë¦¼ í›„ ì¸ë¼ì¸ ë²„íŠ¼ ì „ì†¡

```
ğŸ–ï¸ ë‹¹ì‹ ì˜ ì •ì„ í•œìë¡œ ë‚¨ê¸¸ê¹Œìš”, í•œê¸€ë¡œ ë‚¨ê¸¸ê¹Œìš”?
[æƒ… í•œì] [ì • í•œê¸€]
```

#### ì½œë°±: `nft:{chainId}:{variant}`
- variant=0 â†’ æƒ… (í•œì)
- variant=1 â†’ ì • (í•œê¸€)

#### ê²€ì¦
1. chainId, variant ìˆ«ì ìœ íš¨ì„±
2. variant ë²”ìœ„: 0 ë˜ëŠ” 1ë§Œ í—ˆìš©
3. **ì°¸ì—¬ì ê²€ì¦**: `isChainParticipant(chainId, userId)` â€” ë¸”ë¡ ì‘ì„±ìë§Œ ê°€ëŠ¥
4. ì´ë¯¸ `delivered` â†’ "ì´ë¯¸ ë¯¼íŒ…ë¨" ì•ˆë‚´

### 7.2 ìˆ˜ë™ ë¯¼íŒ… (ìœ ì € ì„ íƒ)

```
ë²„íŠ¼ í´ë¦­ â†’ ì„ íƒ ë©”ì‹œì§€ ì‚­ì œ â†’ NFT ë¯¼íŒ… â†’ ì´ë¯¸ì§€ ì „ì†¡ â†’ ì•¨ë²” ì „ì†¡ â†’ delivered
```

1. ì„ íƒ ë©”ì‹œì§€ ì‚­ì œ (`deleteMessage`)
2. `mintCompletionNFT(chainId, variant)`
   - ìœ ì € ì§€ê°‘ ì£¼ì†Œë¡œ ì†Œìš¸ë°”ìš´ë“œ NFT ë¯¼íŒ… (ì—†ìœ¼ë©´ deployer ì£¼ì†Œ)
   - `jungSoulbound.mint(to, chainId, tz, blockCount, slot, variant)`
3. NFT ì´ë¯¸ì§€ ìƒì„± (`generateNftImage`)
   - resvg-jsë¡œ SVG â†’ PNG (1600px)
   - Noto Sans KR í°íŠ¸ ì„œë¸Œì…‹ (ì •+æƒ…)
   - ì‹¤íŒ¨ ì‹œ í…ìŠ¤íŠ¸ë§Œ ì „ì†¡
4. `sendAlbum(chainId, variant)`
5. `markDelivered(chainId)` â†’ status=`delivered`

### 7.3 ìë™ ë¯¼íŒ… (24h ë¯¸ì„ íƒ)

#### íŠ¸ë¦¬ê±°
- **í¬ë¡ **: ë§¤ì‹œ ì •ê°, `getStaleNotifiedChains(now)` ì¡°íšŒ

#### ì¡°ê±´
```sql
status = 'notified' AND datetime(completed_at, '+24 hours') <= now
```

#### í”Œë¡œìš°
- ê¸°ë³¸ variant=0 (æƒ… í•œì)ë¡œ ìë™ ë¯¼íŒ…
- ì•¨ë²” ì „ì†¡
- `delivered`ë¡œ ìƒíƒœ ë³€ê²½
- ë¡œê·¸: `ğŸ–ï¸ Auto-minted NFT for stale chain #123 (default æƒ…)`

---

## 8. ì™„ì£¼ ì•¨ë²” ì „ì†¡

### íŠ¸ë¦¬ê±°
- NFT ë¯¼íŒ… ì§í›„ (ìˆ˜ë™ ë˜ëŠ” ìë™)
- ë˜ëŠ” ì˜¨ì²´ì¸ ë¹„í™œì„± ì‹œ ì™„ì£¼ ì•Œë¦¼ ì§í›„

### ìƒì„± ê³¼ì • (`generateAlbumHtml`)

```
ì‚¬ì§„ ë‹¤ìš´ë¡œë“œ â†’ WebP ë³€í™˜ â†’ ìº¡ì…˜ ë²ˆì—­ â†’ HTML ì¡°ë¦½ â†’ í…”ë ˆê·¸ë¨ íŒŒì¼ ì „ì†¡
```

1. **ì‚¬ì§„ ì²˜ë¦¬**: í…”ë ˆê·¸ë¨ APIë¡œ ë‹¤ìš´ë¡œë“œ â†’ cwebpë¡œ WebP ë³€í™˜ (50% í’ˆì§ˆ, 500px ë¦¬ì‚¬ì´ì¦ˆ) â†’ base64
2. **ìº¡ì…˜ ë²ˆì—­**: ì‘ì„±ì ì–¸ì–´ â‰  ìˆ˜ì‹ ì ì–¸ì–´ â†’ Gemini AI ë²ˆì—­
3. **íˆì–´ë¡œ ì„¹ì…˜**: NFT SVG + "Soulbound NFT â€” Proof of ì •/æƒ…" + Chain/Blocks/Network ì •ë³´
4. **ì¹´ë“œ ì„¹ì…˜**: ë¸”ë¡ë³„ ì¹´ë“œ (ì‚¬ì§„ + ì‘ì„±ì + ë„ì‹œ + ì‹œê°„ + ì›ë¬¸/ë²ˆì—­ ìº¡ì…˜)
5. **ìì²´ ì™„ê²° HTML**: ëª¨ë“  ì´ë¯¸ì§€ base64 ì„ë² ë”©, ì™¸ë¶€ ì˜ì¡´ì„± ì—†ìŒ

### íŠ¹ì§•
- ì˜¤í”„ë¼ì¸ ì—´ëŒ ê°€ëŠ¥
- ìŠ¤í¬ë¡¤ ë¦¬ë¹Œ ì• ë‹ˆë©”ì´ì…˜ (IntersectionObserver)
- ëª¨ë°”ì¼ ë°˜ì‘í˜•
- ì´ì¤‘ ì–¸ì–´ ìº¡ì…˜ (ì›ë¬¸ + ë²ˆì—­)

---

## 9. ì—£ì§€ ì¼€ì´ìŠ¤

### 9.1 ì†”ë¡œ ì²´ì¸
| ìƒí™© | ì•„ë¬´ë„ ì´ì–´ì“°ì§€ ì•ŠìŒ |
|------|---------------------|
| ê²°ê³¼ | 24h í›„ 1ë¸”ë¡ìœ¼ë¡œ ë§Œë£Œ |
| ì•Œë¦¼ | `complete_solo` ë©”ì‹œì§€ (ë£¨íŠ¸ ì—†ìŒ) |
| NFT | ì‹œì‘ìì—ê²Œ ë¯¼íŒ… |
| ì•¨ë²” | 1ì¥ì§œë¦¬ ì•¨ë²” |

### 9.2 ìŠ¤í‚µ
| ìƒí™© | ìœ ì €ê°€ "ìŠ¤í‚µ" í´ë¦­ |
|------|-------------------|
| ê²°ê³¼ | assignment â†’ `skipped`, ë©”ì‹œì§€ ì‚­ì œ |
| ë‹¤ìŒ | íì— ë‹¤ìŒ ì–´ì‚¬ì¸ë¨¼íŠ¸ ìˆìœ¼ë©´ ì¦‰ì‹œ í‘œì‹œ |
| ì²´ì¸ | í•´ë‹¹ ìŠ¬ë¡¯ ë¹„ì–´ìˆìŒ, ë‹¤ìŒ TZ ìœ ì €ì—ê²Œ ì¬ë°°ì • |

### 9.3 ì–´ì‚¬ì¸ë¨¼íŠ¸ ë§Œë£Œ
| ìƒí™© | 1ì‹œê°„ ë‚´ ë¯¸ì‘ì„± |
|------|----------------|
| ê²°ê³¼ | assignment â†’ `expired`, ë©”ì‹œì§€ ì‚­ì œ |
| ì²˜ë¦¬ | ë§¤ì‹œ ì •ê° í¬ë¡ ì—ì„œ ì¼ê´„ ë§Œë£Œ |
| ì²´ì¸ | í•´ë‹¹ ìŠ¬ë¡¯ ë¹„ì–´ìˆìŒ |

### 9.4 ì¼ì¼ ì‹œì‘ ì œí•œ
| ìƒí™© | í•˜ë£¨ 4ë²ˆì§¸ ì²´ì¸ ì‹œì‘ ì‹œë„ |
|------|--------------------------|
| ê²°ê³¼ | "ì¼ì¼ ì‹œì‘ ì œí•œì— ë„ë‹¬í–ˆìŠµë‹ˆë‹¤" |
| ë¦¬ì…‹ | UTC ìì • |

### 9.5 24h ë¯¸ì„ íƒ (NFT ìŠ¤íƒ€ì¼)
| ìƒí™© | ì™„ì£¼ í›„ NFT ë²„íŠ¼ 24h ë¬´ì‹œ |
|------|---------------------------|
| ê²°ê³¼ | ê¸°ë³¸ æƒ…(í•œì)ë¡œ ìë™ ë¯¼íŒ… |
| ì²˜ë¦¬ | ë§¤ì‹œ ì •ê° í¬ë¡  |

### 9.6 í¬í¬ ë ˆì´ìŠ¤ ì»¨ë””ì…˜
| ìƒí™© | 3ëª…ì´ ê°™ì€ ìŠ¬ë¡¯ì— ë™ì‹œ ì‘ì„± |
|------|----------------------------|
| ê²°ê³¼ | ì²« ë²ˆì§¸ â†’ ì›ë³¸, ë‚˜ë¨¸ì§€ â†’ ê°ê° í¬í¬ ì²´ì¸ ìƒì„± |
| íˆìŠ¤í† ë¦¬ | í¬í¬ ì§€ì  ì´ì „ ë¸”ë¡ ë³µì‚¬ (Copy-on-Fork) |

### 9.7 ì½œë°± ê¶Œí•œ ìœ„ë°˜
| ìƒí™© | ì°¸ì—¬í•˜ì§€ ì•Šì€ ìœ ì €ê°€ NFT ì½œë°± ì‹œë„ |
|------|----------------------------------|
| ê²€ì¦ | `isChainParticipant()` â†’ false |
| ê²°ê³¼ | ì—ëŸ¬ ì½œë°±, ë¯¼íŒ… ì°¨ë‹¨ |

---

## 10. ìƒíƒœ ë‹¤ì´ì–´ê·¸ë¨

### ì²´ì¸ ìƒíƒœ (chains.status)
```
active â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ completed â”€â”€ notified â”€â”€ delivered
  â”‚                                     â”‚                       â”‚
  â”‚  (24h ë§Œë£Œ OR ìŠ¬ë¡¯ 24 ë„ë‹¬)         â”‚  (NFT ì„ íƒ ì „ì†¡)       â”‚  (NFT ë¯¼íŒ… + ì•¨ë²”)
  â”‚                                     â”‚                       â”‚
  â””â”€ ë§¤ë¶„ í¬ë¡ : getExpiredActiveChains   â”‚  ì˜¨ì²´ì¸ ë¹„í™œì„± ì‹œ:     â”‚
                                        â””â”€â”€ delivered (ì§ì ‘)  â”€â”€â”˜
```

### ì–´ì‚¬ì¸ë¨¼íŠ¸ ìƒíƒœ (assignments.status)
```
pending â”€â”€ writing â”€â”€ written
  â”‚           â”‚
  â”‚           â””â”€â”€ expired (1h íƒ€ì„ì•„ì›ƒ)
  â”‚
  â”œâ”€â”€ skipped (ìœ ì € ìŠ¤í‚µ)
  â””â”€â”€ expired (1h íƒ€ì„ì•„ì›ƒ)
```

---

## 11. íƒ€ì´ë° ìƒìˆ˜

| ì´ë²¤íŠ¸ | ì‹œê°„ |
|--------|------|
| ì–´ì‚¬ì¸ë¨¼íŠ¸ ë§Œë£Œ | 1ì‹œê°„ |
| ì²´ì¸ ë§Œë£Œ | ë£¨íŠ¸ start_utc + 24ì‹œê°„ |
| ì²´ì¸ ì „ë‹¬ | start_utc + 24ì‹œê°„ (ê°™ì€ ë¡œì»¬ ì‹œ) |
| NFT ìë™ ë¯¼íŒ… | ì™„ì£¼ ì•Œë¦¼ í›„ 24ì‹œê°„ |
| í¬ë¡  ì£¼ê¸° | ë§¤ë¶„ (ì²´ì¸ ë§Œë£Œ+ì „ë‹¬) / ë§¤ì‹œ ì •ê° (ë°°ì •+ë§Œë£Œ+ë¯¼íŒ…) |
| ì˜¨ì²´ì¸ ë¸”ë¡ ë”œë ˆì´ | 2ì´ˆ (nonce ì•ˆì „) |
| ì¼ì¼ ì‹œì‘ ë¦¬ì…‹ | UTC ìì • |
| ì•Œë¦¼ ì‹œê°„ ê¸°ë³¸ê°’ | ì˜¤ì „ 8ì‹œ ~ ì˜¤í›„ 10ì‹œ (ë¡œì»¬) |

---

## ì „ì²´ íƒ€ì„ë¼ì¸ ì˜ˆì‹œ

```
Day 1, 09:15 KST (00:15 UTC)
  â””â”€ JBê°€ ì„±ë‚¨ì‹œì—ì„œ ì • ì‹œì‘ (chain #323, chain_hour=9)
     â””â”€ ë¸”ë¡ 1/24 ì €ì¥

Day 1, 09:00~10:00 UTC+8 (í¬ë¡  ì •ê°)
  â””â”€ íƒ€ì´í˜ì´ ìœ ì €ì—ê²Œ ë°°ì •
     â””â”€ 1ì‹œê°„ ë‚´ ì‚¬ì§„ ì „ì†¡ â†’ ë¸”ë¡ 2/24

Day 1, 09:00~10:00 UTC+7 (í¬ë¡  ì •ê°)
  â””â”€ ë°©ì½• ìœ ì €ì—ê²Œ ë°°ì •
     â””â”€ ì‚¬ì§„ ì „ì†¡ â†’ ë¸”ë¡ 3/24
     â””â”€ ê°™ì€ ì‹œê°„ ë‹¤ë¥¸ ìœ ì €ë„ ì‘ì„± â†’ í¬í¬ ë°œìƒ!

... (24ê°œ íƒ€ì„ì¡´ ìˆœíšŒ) ...

Day 2, 00:15 UTC (= Day 1 start_utc + 24h)
  â””â”€ ë§¤ë¶„ í¬ë¡ : chain ë§Œë£Œ â†’ status=completed, deliver_at ì„¤ì •

Day 2, 00:15 UTC (deliver_at ë„ë‹¬)
  â””â”€ ë§¤ë¶„ í¬ë¡ : ì™„ì£¼ ì•Œë¦¼ + NFT ì„ íƒ ì „ì†¡ â†’ status=notified

Day 2, 00:20 UTC
  â””â”€ JBê°€ "ì • í•œê¸€" ì„ íƒ â†’ NFT ë¯¼íŒ… â†’ ì•¨ë²” ì „ì†¡ â†’ status=delivered

(ë§Œì•½ 24h ë¯¸ì„ íƒ ì‹œ)
Day 3, 00:00 UTC (ì •ê° í¬ë¡ )
  â””â”€ ìë™ ë¯¼íŒ… (ê¸°ë³¸ æƒ…) â†’ ì•¨ë²” ì „ì†¡ â†’ status=delivered
```
